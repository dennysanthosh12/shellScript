package com.EIS.TCS.apiadmin.Controller;

import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.EIS.TCS.apiadmin.Model.NodeEndpoint;
import com.EIS.TCS.apiadmin.Services.ApiadminServices;

@RestController
@RequestMapping("apiv1")
public class ApiadminController {

	@Autowired
	private ApiadminServices apiService;
	
	@GetMapping("/node")
	public ResponseEntity<?> getNodeDetails(){
		try {
			
			return new ResponseEntity<>(apiService.getNodeDetails(),HttpStatus.ACCEPTED);
			
		} catch (Exception e) {
			return new ResponseEntity<>(e.getMessage(),HttpStatus.INTERNAL_SERVER_ERROR);
		}
	}
	
	@PostMapping("/update/endpoint")
	public ResponseEntity<?> updateHostPort(@RequestBody ArrayList<NodeEndpoint> endpoints){
		try {
			return new ResponseEntity<>(apiService.updateHostPort(endpoints),HttpStatus.CREATED);
		} catch (Exception e) {
			return new ResponseEntity<>(e.getMessage(),HttpStatus.INTERNAL_SERVER_ERROR);
		}
	}
	
	@DeleteMapping("/remove/endpoint")
	public ResponseEntity<?> removeHostPort(@RequestBody NodeEndpoint endpoint){
		try {
			return apiService.removeHostPort(endpoint);
		} catch (Exception e) {
			return new ResponseEntity<>(e.getMessage(),HttpStatus.INTERNAL_SERVER_ERROR);
		}
	}
}


package com.EIS.TCS.apiadmin.Model;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Table;
import jakarta.persistence.UniqueConstraint;
import lombok.Data;
import lombok.NoArgsConstructor;

@Entity
@Table(
  uniqueConstraints =
    @UniqueConstraint(columnNames = {"host","port"})
)
@Data
@NoArgsConstructor
public class NodeEndpoint {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String host;
    private int port;
    private String protocol;
    private boolean active;
}
 curl -v -k -X DELETE http://10.177.44.180:50032/apiv1/remove/endpoint -H"Authorization:Bearer $TOKEN" -d'{"host":"10.177.44.52","port":4419}'
*   Trying 10.177.44.180:50032...
* Connected to 10.177.44.180 (10.177.44.180) port 50032 (#0)
> DELETE /apiv1/remove/endpoint HTTP/1.1
> Host: 10.177.44.180:50032
> User-Agent: curl/7.76.1
> Accept: */*
> Authorization:Bearer eyJhbGciOiJSUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX1VTRVIiXSwic3ViIjoiRGVubnkiLCJpYXQiOjE3NzEwNzE0MzgsImV4cCI6MTc3MTA3Mjg3OH0.FtFoFAU-vNrSyHM3OYwf_gxiKms-57_KWkOq5Kra1et2Bt-wywyB1FqI2BGiigdFCAYDuhyHrpeyZ0HOTtL50WpkNdek-MTapBoOIW6u_0qYyNFdTmFrNBpTY2Vgu26CuF3I7fLy6Oiu7dUoyBbgBf3ThbJ4RnxV_JbnMj1xRwIQlqhYcwJUzbkpCMpvp9NmS8b0ictG8CmpyZ7tP1yiNfYOwyrRSW2usSujU5lGaIr03xLTmGOOfrOxOCodlqRERNAOcpKJQIBX7p-QnQFKtI2I72_fg8Jm5Bxk5v7_bS6JYZte5PeDOjkd0MhICGigCkM25MAOcffXiBwpTt3Law
> Content-Length: 35
> Content-Type: application/x-www-form-urlencoded
>
* Mark bundle as not supporting multiuse
< HTTP/1.1 403
< X-Content-Type-Options: nosniff
< X-XSS-Protection: 0
< Cache-Control: no-cache, no-store, max-age=0, must-revalidate
< Pragma: no-cache
< Expires: 0
< X-Frame-Options: DENY
< Content-Length: 0
< Date: Sat, 14 Feb 2026 12:20:57 GMT
<
* Connection #0 to host 10.177.44.180 left intact
[eisuser@EISUATEXP09 ~]$
2026-02-14T12:20:57.096Z  WARN 1 --- [apiadmin] [nio-8080-exec-6] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.http.converter.HttpMessageNotReadableException: Required request body is missing: public org.springframework.http.ResponseEntity<?> com.EIS.TCS.apiadmin.Controller.ApiadminController.removeHostPort(com.EIS.TCS.apiadmin.Model.NodeEndpoint)]
2026-02-14T12:20:57.097Z DEBUG 1 --- [apiadmin] [nio-8080-exec-6] o.s.security.web.FilterChainProxy        : Securing GET /error
2026-02-14T12:20:57.097Z DEBUG 1 --- [apiadmin] [nio-8080-exec-6] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2026-02-14T12:20:57.097Z DEBUG 1 --- [apiadmin] [nio-8080-exec-6] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
